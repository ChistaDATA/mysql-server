# MySQL Rest Service schema created.
# MySQL Rest Service, server accounts configured.
# mysqlrouter_keyring
#  * "set" root password ""
# mysqlrouter_keyring
#  * set rest-user jwt_secret "secret12345"
# Generating config into generated_router_1.cnf
#  * https
#  * MySQL Rest Service
# Connection "router.1" active
# restart:generated_router_1.cnf
# DB `basic_schema` - created 


## I. Verify that router detect changes in
#
# 1. DB_OBJECT
# 2. DB_SCHEMA
# 3. OBJECT_FIELD
# 3. OBJECT_REFERENCE
#
#
# Registred SERVICE at path: /svc
# Registred DB_SCHEMA at path: /svc/basic
# Registred DB_OBJECT at path: /svc/basic/t1
# Registred DB_OBJECT at path: /svc/basic/t2
# Registred DB_OBJECT at path: /svc/basic/t4
# Registred OBJECT_REF at basic_schema.table2
GET /svc/basic/t2/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "B83C8015DB8BA0740281293624FAFDA1752BB629E1D16EFD86F4AEBCFBF16446"
    }
}
OK

#
# I.1
GET /svc/basic/t2/1
Not Found(404)
GET /svc/basic/t2_new/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2_new/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "B83C8015DB8BA0740281293624FAFDA1752BB629E1D16EFD86F4AEBCFBF16446"
    }
}
OK
GET /svc/basic/t1/1
{
    "id": 1,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t1/1"
        }
    ],
    "_metadata": {
        "etag": "D6132AC057950FB3305B3B1DB876B6B31B92F837E93F57CE3734B6A935FDA9E7"
    }
}
OK

#
# I.2
GET /svc/basic/t2_new/1
Not Found(404)
GET /svc/basic/t1/1
Not Found(404)
GET /svc/basic_new/t1/1
{
    "id": 1,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t1/1"
        }
    ],
    "_metadata": {
        "etag": "D6132AC057950FB3305B3B1DB876B6B31B92F837E93F57CE3734B6A935FDA9E7"
    }
}
OK
GET /svc/basic_new/t2_new/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t2_new/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "B83C8015DB8BA0740281293624FAFDA1752BB629E1D16EFD86F4AEBCFBF16446"
    }
}
OK

#
# I.3
GET /svc/basic_new/t2_new/1
{
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t2_new/1"
        }
    ],
    "my_id": 1,
    "my_date": "1977-01-21 00:00:00.000000",
    "my_name": "First row",
    "my_comments": "First comment",
    "_metadata": {
        "etag": "B3476BB71FE2E6C243273E901FD73536859E2B55FF1F2F178DD6ED17554817C3"
    }
}
OK

#
# I.4
GET /svc/basic_new/t4/2
{
    "t2": {
        "my_id": 2,
        "my_date": "1977-01-21 00:00:00.000000",
        "my_name": "Second row",
        "my_comments": null
    },
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t4/2"
        }
    ],
    "my_id": 2,
    "last_name": "White",
    "table2_id": 2,
    "first_name": "Haley",
    "_metadata": {
        "etag": "59C2F0FE184B6F725CB1C8E3C6125B34DE14A9C288DD517094344C43E8F35774"
    }
}
OK
# Modified OBJECT_REFERENCE to be an unnested filed.
GET /svc/basic_new/t4/2
{
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t4/2"
        }
    ],
    "my_id": 2,
    "my_date": "1977-01-21 00:00:00.000000",
    "my_name": "Second row",
    "last_name": "White",
    "table2_id": 2,
    "first_name": "Haley",
    "my_comments": null,
    "_metadata": {
        "etag": "133A8CA224F68304EF0D9C989124C2225C83697D8933956A565EBC7B47712E7F"
    }
}
OK
DROP SCHEMA basic_schema;
DROP SCHEMA mysql_rest_service_metadata;
DROP ROLE mysql_rest_service_admin;
DROP ROLE mysql_rest_service_schema_admin;
DROP ROLE mysql_rest_service_meta_provider;
DROP ROLE mysql_rest_service_data_provider;
