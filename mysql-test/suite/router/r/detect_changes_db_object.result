# MySQL Rest Service schema created.
# MySQL Rest Service, server accounts configured.
# mysqlrouter_keyring
#  * "set" root password ""
# mysqlrouter_keyring
#  * set rest-user jwt_secret "secret12345"
# Generating config into generated_router_1.cnf
#  * https
#  * MySQL Rest Service
# Connection "router.1" active
# restart:generated_router_1.cnf
# DB `basic_schema` - created 


## I. Verify that router detect changes in
#
# 1. DB_OBJECT
# 2. DB_SCHEMA
# 3. OBJECT_FIELD
# 3. OBJECT_REFERENCE
#
#
# Registred SERVICE at path: /svc
# Registred DB_SCHEMA at path: /svc/basic
# Registred DB_OBJECT at path: /svc/basic/t1
# Registred DB_OBJECT at path: /svc/basic/t2
# Registred DB_OBJECT at path: /svc/basic/t4
# Registred OBJECT_REF at basic_schema.table2
GET /svc/basic/t2/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "9A2E43465461EFB43E9B0677C9EB126B86A831270913B7B3764A66985D92D012"
    }
}
OK

#
# I.1
GET /svc/basic/t2/1
Not Found(404)
GET /svc/basic/t2_new/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2_new/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "9A2E43465461EFB43E9B0677C9EB126B86A831270913B7B3764A66985D92D012"
    }
}
OK
GET /svc/basic/t1/1
{
    "id": 1,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t1/1"
        }
    ],
    "_metadata": {
        "etag": "763AF95BE227B2068D8C387FB7A37003FF458C00373FFFE4AED008BD798378C6"
    }
}
OK

#
# I.2
GET /svc/basic/t2_new/1
Not Found(404)
GET /svc/basic/t1/1
Not Found(404)
GET /svc/basic_new/t1/1
{
    "id": 1,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t1/1"
        }
    ],
    "_metadata": {
        "etag": "763AF95BE227B2068D8C387FB7A37003FF458C00373FFFE4AED008BD798378C6"
    }
}
OK
GET /svc/basic_new/t2_new/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t2_new/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "9A2E43465461EFB43E9B0677C9EB126B86A831270913B7B3764A66985D92D012"
    }
}
OK

#
# I.3
GET /svc/basic_new/t2_new/1
{
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t2_new/1"
        }
    ],
    "my_id": 1,
    "my_date": "1977-01-21 00:00:00.000000",
    "my_name": "First row",
    "my_comments": "First comment",
    "_metadata": {
        "etag": "A2C0A4ACFAEF089B0ED2F3DF2220953ED2E7DA97D6036DC10D140C744601DD6B"
    }
}
OK

#
# I.4
GET /svc/basic_new/t4/2
{
    "t2": {
        "my_id": 2,
        "my_date": "1977-01-21 00:00:00.000000",
        "my_name": "Second row",
        "my_comments": null
    },
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t4/2"
        }
    ],
    "my_id": 2,
    "last_name": "White",
    "table2_id": 2,
    "first_name": "Haley",
    "_metadata": {
        "etag": "33E07357CAE5732E10A6967C76E528C0F0485F04E9086B1BC0C310CEB2F055EC"
    }
}
OK
# Modified OBJECT_REFERENCE to be an unnested filed.
GET /svc/basic_new/t4/2
{
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic_new/t4/2"
        }
    ],
    "my_id": 2,
    "my_date": "1977-01-21 00:00:00.000000",
    "my_name": "Second row",
    "last_name": "White",
    "table2_id": 2,
    "first_name": "Haley",
    "my_comments": null,
    "_metadata": {
        "etag": "7D85659B3D74390DE91545C649B188877155B706836CA5F309DA8C64F23A9C8B"
    }
}
OK
DROP SCHEMA basic_schema;
DROP SCHEMA mysql_rest_service_metadata;
DROP ROLE mysql_rest_service_admin;
DROP ROLE mysql_rest_service_schema_admin;
DROP ROLE mysql_rest_service_meta_provider;
DROP ROLE mysql_rest_service_data_provider;
