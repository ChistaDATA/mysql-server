# MySQL Rest Service schema created.
# MySQL Rest Service, server accounts configured.
# mysqlrouter_keyring
#  * "set" root password ""
# mysqlrouter_keyring
#  * set rest-user jwt_secret "secret12345"
# Generating config into generated_router_1.cnf
#  * https
#  * MySQL Rest Service
# Connection "router.1" active
# restart:generated_router_1.cnf
# DB `basic_schema` - created 
CREATE USER 'u1'@'%' IDENTIFIED BY 'p1';
CREATE USER 'u2'@'%' IDENTIFIED BY 'p2';
CREATE USER 'u3'@'%' IDENTIFIED BY 'p3';


## I. Create servcices that have basic-mysql authentication:
#
## II. Limit the hosts 
#

#
# I.1
START TRANSACTION;
# Registred SERVICE at path: /svc1
# Registred DB_SCHEMA at path: /svc1/basic1
# Registred DB_OBJECT at path: /svc1/basic1/o1
# Registred AUTH APP at path: /svc1
UPDATE  `mysql_rest_service_metadata`.`config` SET data=
'{"authentication":{"throttling":{"perAccount":{"minimumTimeBetweenRequestsInMs":2000,"maximumAttemptsPerMinute":5}}}}';
COMMIT;

#
# II.1
GET /svc1/basic1/o1
{
    "message": "Unauthorized",
    "status": 401
}
OK
GET /svc1/authentication/login

OK
GET /svc1/authentication/login

OK
GET /svc1/authentication/login
{"message":"Too Many Requests","status":429}
OK
GET /svc1/authentication/login

OK
GET /svc1/authentication/login

OK
GET /svc1/authentication/login

OK
GET /svc1/authentication/login
{"message":"Too Many Requests","status":429}
OK
GET /svc1/authentication/login

OK
GET /svc1/authentication/login
{"message":"Too Many Requests","status":429}
OK
GET /svc1/authentication/login

OK
DROP USER 'u1'@'%';
DROP USER 'u2'@'%';
DROP USER 'u3'@'%';
DROP SCHEMA basic_schema;
DROP SCHEMA mysql_rest_service_metadata;
DROP ROLE mysql_rest_service_admin;
DROP ROLE mysql_rest_service_schema_admin;
DROP ROLE mysql_rest_service_meta_provider;
DROP ROLE mysql_rest_service_data_provider;
DROP ROLE mysql_rest_service_dev;
