# MySQL Rest Service schema created.
# MySQL Rest Service, server accounts configured.
# DB `basic_schema` - created
# Registred SERVICE at path: /svc
# Registred DB_SCHEMA at path: /svc/basic
# Registred DB_OBJECT at path: /svc/basic/t2


## I. Verify basic access handling for READ and UPDATE when
##    db_object created with GET/READ permissions only.
#
# 1. Show that REST-GET/READ access is working
# 2. Show that REST-POST/CREATE access doesn't work
#
## II. Verify basic access handling for POST/CREATE when
##     db_object has been extended wtih POST/CREATE permissions.
#
# 1. Show that full-document, send in REST-POST/CREATE is returned with same data
# 2. Show that document without optionals fields, send in REST-POST/CREATE is retruned
#    with nulls in missing fields
# 3. Show that document without autogenerated fields, send in REST-POST/CREATE is returned
#    with those fields filled by MySQL (primary-key-auto-inc, date-with default value now)
#
## III. Verify error-cases for REST-POST/CREATE access
# 1. Set "allow_sorting" for field "id", and verify that MRS plugin displays
#    the column in GET and POST request.
#    Test case for a bug.
# 2. POST document with non-registred field in `object_filed`, verfify returned error 400.

#
# I.1
GET /svc/basic/t2/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "77004781476882B937CFE9FFC837CC8FC1D13F717B87F6ABCE20142D1C4140D6"
    }
}
OK

#
# I.2
POST /svc/basic/t2 (payload-size:34)
{
    "message": "Forbidden",
    "status": 403
}
OK

#
# II.1
POST /svc/basic/t2/ (payload-size:85)
{
    "id": 11,
    "date": "2017-01-01 00:00:00.000000",
    "name": "entry-with-all-fields",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/11"
        }
    ],
    "comments": "something-new",
    "_metadata": {
        "etag": "625F2B0C107AE737E6608EE8AC15DBC84B56888E681418392C3F40C9DC350449"
    }
}
OK

#
# II.2
POST /svc/basic/t2/ (payload-size:58)
{
    "id": 12,
    "date": "2022-02-02 00:00:00.000000",
    "name": "entry-without-comment",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/12"
        }
    ],
    "comments": null,
    "_metadata": {
        "etag": "91D35A16FBE94AFFA2A3C57CFF56F3A87F5F564CCB3B0620181F3D58081A6479"
    }
}
OK

#
# II.3
POST /svc/basic/t2/ (payload-size:36)
{
    "id": 13,
    "date": "2024-07-16 14:43:22.000000",
    "name": "entry-without-id-and-date",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/13"
        }
    ],
    "comments": null,
    "_metadata": {
        "etag": "8EE59DA10731ECCA266F590B7C173FA407545BFC4A0788F7D8CAF4F24D1A8F85"
    }
}
OK

#
# III.1
UPDATE mysql_rest_service_metadata.object_field
SET allow_sorting=1 WHERE name = "id";
GET /svc/basic/t2/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "77004781476882B937CFE9FFC837CC8FC1D13F717B87F6ABCE20142D1C4140D6"
    }
}
OK
POST /svc/basic/t2 (payload-size:73)
{
    "id": 21,
    "date": "2022-02-02 00:00:00.000000",
    "name": "entry-after-allow-sort",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/21"
        }
    ],
    "comments": "",
    "_metadata": {
        "etag": "6700B0D3D16088C1C968E64F7EF51ADAB8EB9CE66F956F526B8C4A8B422204E5"
    }
}
OK

#
# III.2
POST /svc/basic/t2 (payload-size:98)
{
    "message": "Unknown field 'non-existing-filed' in JSON document",
    "status": 400
}
OK
DROP SCHEMA basic_schema;
DROP SCHEMA mysql_rest_service_metadata;
DROP ROLE mysql_rest_service_admin;
DROP ROLE mysql_rest_service_schema_admin;
DROP ROLE mysql_rest_service_meta_provider;
DROP ROLE mysql_rest_service_data_provider;
DROP ROLE mysql_rest_service_dev;
